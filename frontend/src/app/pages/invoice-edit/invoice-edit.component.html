<div class="row row-space-class">
  <div class="col-12">
    <div class="comn-title-tag d-sm-flex align-items-center">
      <h1>Invoice</h1>
      <div
        class="
          ml-auto
          mt-3 mt-md-0
          d-sm-flex
          align-items-center
          justify-content-center
          text-center
        "
      >
        <div>
          <button
            type="button"
            class="btn-white mr-2"
            [routerLink]="['/invoice']"
          >
            Cancel
          </button>
          <button type="submit" class="btn-white mr-2" (click)="onSubmit()">
            Save
          </button>
        </div>
        <div class="form-group mb-0 text-sm-right d-sm-inline-block">
          <div class="btn-group drop-new-tbl">
            <select
              #val
              class="custom-select form-control input-style"
              (change)="onSaveWithOption(val.value)"
            >
              <option selected="" value="1">Save and new</option>
              <option value="2">Save and send</option>
              <option value="3">Save & Share</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12">
    <div class="dash-white-bx">
      <form>
        <div class="row">
          <div class="col-6">
            <p class="p-tag-text">
              Invoice No. KVPL-{{ invoice?.branch_id }}-{{ invoice?.id }}
            </p>
          </div>
          <div class="col-6 text-right">
            <p class="p-tag-text">
              <span>Balance Due</span> ${{ invoice?.amount }}
            </p>
          </div>
          <div class="col-lg-8 col-md-7 fix-comn-div">
            <div class="row">
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Customer Name :</label>
                  <select
                    name="name"
                    class="custom-select form-control input-style"
                    [(ngModel)]="invoice.name"
                  >
                    <option
                      *ngFor="let cust of customer"
                      value="{{ cust.name }}"
                      [selected]="cust.name == invoice.name"
                    >
                      {{ cust.name }}
                    </option>
                  </select>
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Customer Email :</label>
                  <input
                    type="email"
                    name="email"
                    class="form-control input-style"
                    placeholder="{{ invoice?.email }}"
                    [(ngModel)]="invoice.email"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Phone No. :</label>
                  <input
                    type="text"
                    name="phone_no"
                    class="form-control input-style"
                    placeholder="{{ invoice?.phone_no }}"
                    [(ngModel)]="invoice.phone_no"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Invoice No. :</label>
                  <input
                    type="text"
                    name="invoice_id"
                    class="form-control input-style"
                    placeholder="{{ invoice?.invoice_id }}"
                    [(ngModel)]="invoice.invoice_id"
                    disabled
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Terms :</label>
                  <input
                    type="text"
                    name="terms"
                    class="form-control input-style"
                    placeholder="{{ invoice?.terms }}"
                    [(ngModel)]="invoice.terms"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Invoice Date :</label>
                  <input
                    type="date"
                    name="date"
                    class="form-control input-style"
                    placeholder="{{ invoice?.date }}"
                    [(ngModel)]="invoice.date"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Due Date :</label>
                  <input
                    type="date"
                    name="due_date"
                    class="form-control input-style"
                    placeholder="{{ invoice?.due_date }}"
                    [(ngModel)]="invoice.due_date"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Ship Via :</label>
                  <input
                    type="text"
                    name="via"
                    class="form-control input-style"
                    placeholder="{{ invoice?.via }}"
                    [(ngModel)]="invoice.via"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Shipping Date :</label>
                  <input
                    type="date"
                    name="ship"
                    class="form-control input-style"
                    placeholder="{{ invoice?.ship }}"
                    [(ngModel)]="invoice.ship"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Ship To. :</label>
                  <input
                    type="text"
                    name="ship_to"
                    class="form-control input-style"
                    placeholder="{{ invoice?.ship_to }}"
                    [(ngModel)]="invoice.ship_to"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">P O Number. :</label>
                  <input
                    type="text"
                    name="p_o_number"
                    class="form-control input-style"
                    placeholder="{{ invoice?.p_o_number }}"
                    [(ngModel)]="invoice.p_o_number"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Flight No :</label>
                  <input
                    type="text"
                    name="flight_no"
                    class="form-control input-style"
                    placeholder="{{ invoice?.flight_no }}"
                    [(ngModel)]="invoice.flight_no"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">F.O.B :</label>
                  <input
                    type="text"
                    name="f_o_b"
                    class="form-control input-style"
                    placeholder="{{ invoice?.f_o_b }}"
                    [(ngModel)]="invoice.f_o_b"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Broker :</label>
                  <input
                    type="text"
                    name="broker"
                    class="form-control input-style"
                    placeholder="{{ invoice?.broker }}"
                    [(ngModel)]="invoice.broker"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Brokerage :</label>
                  <input
                    type="text"
                    name="brokerage"
                    class="form-control input-style"
                    placeholder="{{ invoice?.brokerage }}"
                    [(ngModel)]="invoice.brokerage"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Pre Carraige By :</label>
                  <input
                    type="text"
                    name="pre_carraige_by"
                    class="form-control input-style"
                    placeholder="{{ invoice?.pre_carraige_by }}"
                    [(ngModel)]="invoice.pre_carraige_by"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Final Destination :</label>
                  <input
                    type="text"
                    name="final_dest"
                    class="form-control input-style"
                    placeholder="{{ invoice?.final_dest }}"
                    [(ngModel)]="invoice.final_dest"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Port Of Loading :</label>
                  <input
                    type="text"
                    name="port_of_loading"
                    class="form-control input-style"
                    placeholder="{{ invoice?.port_of_loading }}"
                    [(ngModel)]="invoice.port_of_loading"
                  />
                </div>
              </div>
              <div class="col-xl-4 col-lg-6">
                <div class="form-group d-sm-flex align-items-center">
                  <label class="lbl-class">Country Of Gooda :</label>
                  <input
                    type="text"
                    name="country_of_goods"
                    class="form-control input-style"
                    placeholder="{{ invoice?.country_of_goods }}"
                    [(ngModel)]="invoice.country_of_goods"
                  />
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-5 fix-comn-div2">
            <div class="row">
              <div class="col-xl-6">
                <div class="form-group d-sm-flex">
                  <label class="lbl-class">Billing Address :</label>
                  <textarea
                    name="billing_address"
                    class="form-control input-style"
                    rows="5"
                    [(ngModel)]="invoice.billing_address"
                  ></textarea>
                </div>
              </div>
              <div class="col-xl-6">
                <div class="form-group d-sm-flex">
                  <label class="lbl-class">Shipping Address :</label>
                  <textarea
                    name="shipping_address"
                    class="form-control input-style"
                    rows="5"
                    [(ngModel)]="invoice.shipping_address"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12">
            <div class="row justify-content-md-end">
              <div class="col-xl-3 col-md-4">
                <div class="form-group mb-md-0 d-sm-flex align-items-center">
                  <label class="lbl-class">Amounts are</label>
                  <select class="custom-select form-control input-style">
                    <option selected="">Exclusive Tax</option>
                    <option value="1">One</option>
                    <option value="2">Two</option>
                    <option value="3">Three</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <table
        datatable
        [dtOptions]="dtOptions"
        [dtTrigger]="dtTrigger"
        id="invoice"
        class="display"
      >
        <thead>
          <tr>
            <th>Service Date</th>
            <th>Product No.</th>
            <th>Product Name</th>
            <th>Discription</th>
            <th>Qty</th>
            <th>Rate</th>
            <th>Amount</th>
            <th>Tax</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody *ngIf="data?.length != 0">
          <tr *ngFor="let invoice of data; index as i">
            <td *ngIf="invoice.isEditable">
              <input
                type="date"
                class="input-style"
                [name]="data[i].date"
                [(ngModel)]="data[i].date"
                [placeholder]="invoice.date"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.date | date }}
            </td>
            <td (dblclick)="invoice.isEditable = !invoice.isEditable">
              {{ invoice.id }}
            </td>
            <td *ngIf="invoice.isEditable">
              <input
                type="text"
                class="input-style"
                [name]="data[i].name"
                [(ngModel)]="data[i].name"
                [placeholder]="invoice.name"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.name }}
            </td>
            <td *ngIf="invoice.isEditable">
              <input
                type="description"
                class="input-style"
                [name]="data[i].description"
                [(ngModel)]="data[i].description"
                [placeholder]="invoice.description"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.description }}
            </td>
            <td *ngIf="invoice.isEditable">
              <input
                type="number"
                class="input-style"
                [name]="data[i].qty"
                [(ngModel)]="data[i].qty"
                [placeholder]="invoice.qty"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.qty }}
            </td>
            <td *ngIf="invoice.isEditable">
              <input
                type="number"
                class="input-style"
                [name]="data[i].rate"
                [(ngModel)]="data[i].rate"
                [placeholder]="invoice.rate"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.rate }}
            </td>
            <td *ngIf="invoice.isEditable">
              <input
                type="number"
                class="input-style"
                [name]="data[i].amount"
                [(ngModel)]="data[i].amount"
                [placeholder]="invoice.amount"
                (keyup.enter)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
              />
            </td>
            <td
              *ngIf="!invoice.isEditable"
              (dblclick)="invoice.isEditable = !invoice.isEditable"
            >
              {{ invoice.amount }} {{ invoice.currency }}
            </td>
            <td (dblclick)="invoice.isEditable = !invoice.isEditable">
              {{ invoice.tax }}
            </td>
            <td>
              <a
                href="javascript:void(0)"
                (click)="invoice.isEditable = !invoice.isEditable"
                *ngIf="!invoice.isEditable"
              >
                <img
                  src="/assets/images/edit-icon-table.svg"
                  class="mx-2 table-img-inr"
                  alt=""
                />
              </a>
              <a
                href="javascript:void(0)"
                (click)="
                  [
                    (invoice.isEditable = !invoice.isEditable),
                    onEditProduct(invoice.id)
                  ]
                "
                *ngIf="invoice.isEditable"
                style="margin-right: 10px"
              >
                <i class="fa fa-check fa-lg" aria-hidden="true"></i>
              </a>
              <a
                href="javascript:void(0)"
                (click)="
                  [(invoice.isEditable = !invoice.isEditable), rerender()]
                "
                *ngIf="invoice.isEditable"
                style="margin-right: 6px"
              >
                <i class="fa fa-close fa-lg"></i>
              </a>
              <a
                href="javascript: void(0)"
                (click)="onProductDelete(invoice.id)"
              >
                <img
                  src="assets/images/delete-icon.svg"
                  class="mx-2 table-img-inr"
                  alt=""
                />
              </a>
            </td>
          </tr>
        </tbody>
        <tbody *ngIf="data?.length == 0">
          <tr>
            <td colspan="8" class="no-data-available">No data!</td>
          </tr>
        </tbody>
      </table>
      <div class="row mt-4">
        <div class="col-lg-6">
          <div class="tbl-bottm-section-left">
            <button type="button" class="mr-2">Add Subtotal</button>
          </div>
          <div class="row my-3">
            <div class="col-md-6 form-group">
              <label class="lbl-class mb-sm-2">Messege on Invoice :</label>
              <textarea
                class="form-control input-style"
                rows="4"
                placeholder="This will show up on the invoice"
                name="invoice.notes"
                [(ngModel)]="invoice.notes"
              ></textarea>
            </div>
            <div class="col-12 form-group">
              <label class="lbl-class mb-sm-2"
                >Attachments : <span>Maximum Size: 20MB</span></label
              >
              <div class="file-upload text-center ml-md-0 m-auto">
                <div class="file-upload-inr text-center">
                  <div class="file-upload-content">
                    <img class="file-upload-image" src="" alt="" />
                  </div>
                  <div class="image-upload-wrap">
                    <input
                      class="file-upload-input"
                      type="file"
                      accept="image/*"
                      (change)="handleAttachmentChange($event)"
                    />
                    <img
                      *ngIf="invoice.attachments"
                      src="{{ baseUrl }}{{ invoice?.attachments }}"
                      alt=""
                    />
                  </div>
                  <div class="drag-text">
                    <h3>Drag & Drop files here or click the icon</h3>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 text-right">
          <div class="tbl-bottm-section-right">
            <div class="row justify-content-sm-end">
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <b>Sub Total :</b>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <b>{{ invoice.amount }} {{ invoice.currency }}</b>
              </div>
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <div class="input-group">
                  <select class="custom-select form-control input-style">
                    <option selected="">Discount Percent</option>
                    <option value="10">10%</option>
                    <option value="15">15%</option>
                    <option value="20">20%</option>
                  </select>
                  <div class="input-group-append ml-2 justify-content-end w-25">
                    <span class="input-group-text p-0 border-0">
                      <input type="text" class="form-control input-style" />
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <b>0.00</b>
              </div>
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <b>Total Discount :</b>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <b>0.00</b>
              </div>
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <div class="input-group align-items-center">
                  <label class="lbl-class mr-1">Shipping</label>
                  <select class="custom-select form-control input-style">
                    <option selected="">Select Shipping Tax</option>
                    <option value="10">10%</option>
                    <option value="15">15%</option>
                    <option value="20">20%</option>
                  </select>
                  <div class="input-group-append ml-2 justify-content-end w-25">
                    <span class="input-group-text p-0 border-0">
                      <input type="text" class="form-control input-style" />
                    </span>
                  </div>
                </div>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <b>0.00</b>
              </div>
              <div
                class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right mt-3"
              >
                <b>Total :</b>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right mt-3">
                <b>{{ invoice.amount }} {{ invoice.currency }}</b>
              </div>
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <b>Deposite :</b>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <input
                  type="text"
                  class="form-control input-style w-25 ml-sm-auto"
                />
              </div>
              <div class="col-xl-6 col-md-7 col-sm-8 form-group text-sm-right">
                <b><span>Balance Due :</span></b>
              </div>
              <div class="col-xl-5 col-sm-4 form-group text-sm-right">
                <b
                  ><span>{{ invoice.amount }} {{ invoice.currency }}</span></b
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div
  class="modal fade"
  id="send-invoice-modal"
  tabindex="-1"
  aria-labelledby="send-Invoice-modal"
  aria-hidden="true"
>
  <div
    class="
      modal-dialog
      modal-dialog-centered
      modal-cust-comn
      modal-lg
      modal-dialog-scrollable
    "
  >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Send Invoice</h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <img src="assets/images/modal-close-icon.svg" alt="" />
        </button>
      </div>
      <div class="modal-body">
        <div class="row mdl-edit-invc">
          <div class="col-md-4 form-group">
            <label>Email</label>
            <input #email type="email" class="input-style" required />
          </div>
          <div class="col-12">
            <div class="btn-btm-inr-tabs text-center my-3">
              <button
                type="button"
                class="btn-white mr-2"
                data-dismiss="modal"
                (click)="onSendInvoice(email.value)"
              >
                Send
              </button>
              <button
                type="button"
                class="btn-theme-color"
                data-dismiss="modal"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
